{"version":3,"sources":["actions/BoothActionCreators.js"],"names":["advanceToEmpty","advance","skipSelf","skipped","loadHistoryStart","loadHistoryComplete","loadHistory","dispatch","getState","type","payload","meta","previous","nextBooth","historyID","media","userID","playlistID","playedAt","user","timestamp","opts","arguments","length","undefined","remove","Promise","reject","Error","_ref","moderatorID","reason","users","moderator","Date","now","response","currentHistoryID","playHistory","_id","slice","page","Math","floor","offset","pageSize","size","onStart","onComplete"],"mappings":"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","file":"BoothActionCreators.js","sourcesContent":["import {\n  ADVANCE,\n  BOOTH_SKIP,\n  LOAD_HISTORY_START, LOAD_HISTORY_COMPLETE\n} from '../constants/actionTypes/booth';\nimport { flattenPlaylistItem } from './PlaylistActionCreators';\nimport { get, post } from './RequestActionCreators';\n\nimport { historyIDSelector, isCurrentDJSelector } from '../selectors/boothSelectors';\nimport { currentPlaySelector } from '../selectors/roomHistorySelectors';\nimport { usersSelector } from '../selectors/userSelectors';\nimport mergeIncludedModels from '../utils/mergeIncludedModels';\n\nexport function advanceToEmpty() {\n  return (dispatch, getState) => {\n    dispatch({\n      type: ADVANCE,\n      payload: null,\n      meta: { previous: currentPlaySelector(getState()) }\n    });\n  };\n}\n\n/**\n * Set the current song and DJ.\n */\nexport function advance(nextBooth) {\n  if (!nextBooth || !nextBooth.historyID) {\n    return advanceToEmpty();\n  }\n  const {\n    media, userID, historyID, playlistID, playedAt\n  } = nextBooth;\n  return (dispatch, getState) => {\n    const user = usersSelector(getState())[userID];\n    dispatch({\n      type: ADVANCE,\n      payload: {\n        userID,\n        historyID,\n        playlistID,\n        user,\n        media: flattenPlaylistItem(media),\n        timestamp: playedAt\n      },\n      meta: {\n        previous: currentPlaySelector(getState())\n      }\n    });\n  };\n}\n\nexport function skipSelf(opts = {}) {\n  const remove = !!opts.remove;\n  return (dispatch, getState) => {\n    if (isCurrentDJSelector(getState())) {\n      return dispatch(post('/booth/skip', { remove }));\n    }\n    return Promise.reject(new Error('You\\'re not currently playing.'));\n  };\n}\n\nexport function skipped({ userID, moderatorID, reason }) {\n  return (dispatch, getState) => {\n    const users = usersSelector(getState());\n    dispatch({\n      type: BOOTH_SKIP,\n      payload: {\n        user: users[userID],\n        moderator: users[moderatorID],\n        reason,\n        timestamp: Date.now()\n      }\n    });\n  };\n}\n\nexport function loadHistoryStart() {\n  return { type: LOAD_HISTORY_START };\n}\n\nexport function loadHistoryComplete(response) {\n  return (dispatch, getState) => {\n    const currentHistoryID = historyIDSelector(getState());\n    const { meta } = response;\n    let playHistory = mergeIncludedModels(response);\n    if (playHistory[0] && playHistory[0]._id === currentHistoryID) {\n      playHistory = playHistory.slice(1);\n    }\n    dispatch({\n      type: LOAD_HISTORY_COMPLETE,\n      payload: playHistory,\n      meta: {\n        page: Math.floor(meta.offset / meta.pageSize),\n        size: meta.pageSize\n      }\n    });\n  };\n}\n\nexport function loadHistory() {\n  return get('/booth/history', {\n    onStart: loadHistoryStart,\n    onComplete: loadHistoryComplete\n  });\n}\n"]}