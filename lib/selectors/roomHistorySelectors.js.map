{"version":3,"sources":["selectors/roomHistorySelectors.js"],"names":["byTimestamp","a","b","timestamp","baseSelector","state","roomHistory","roomHistorySelector","history","slice","sort","addOwnVoteProps","id","entry","stats","isDownvote","downvotes","indexOf","isFavorite","favorites","isUpvote","upvotes","currentPlaySelector","currentUserSelector","historyIDSelector","mediaSelector","startTimeSelector","djSelector","currentVotesSelector","user","historyID","media","dj","_id","roomHistoryWithVotesSelector","current","map","unshift"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;;;AAEA,IAAIA,cAAc,SAASA,WAAT,CAAqBC,CAArB,EAAwBC,CAAxB,EAA2B;AAC3C,SAAOD,EAAEE,SAAF,GAAcD,EAAEC,SAAhB,GAA4B,CAA5B,GAAgC,CAAC,CAAxC;AACD,CAFD;;AAIA,IAAIC,eAAe,SAASA,YAAT,CAAsBC,KAAtB,EAA6B;AAC9C,SAAOA,MAAMC,WAAb;AACD,CAFD;;AAIO,IAAIC,sBAAsB,8BAAeH,YAAf,EAA6B,UAAUI,OAAV,EAAmB;AAC/E,SAAOA,QAAQC,KAAR,GAAgBC,IAAhB,CAAqBV,WAArB,CAAP;AACD,CAFgC,CAA1B;;;AAIP,IAAIW,kBAAkB,SAASA,eAAT,CAAyBC,EAAzB,EAA6B;AACjD,SAAO,UAAUC,KAAV,EAAiB;AACtB,WAAO,uBAAS,EAAT,EAAaA,KAAb,EAAoB;AACzBC,aAAO,uBAAS,EAAT,EAAaD,MAAMC,KAAnB,EAA0B;AAC/B;AACAC,oBAAY,CAAC,CAACH,EAAF,IAAQC,MAAMC,KAAN,CAAYE,SAAZ,CAAsBC,OAAtB,CAA8BL,EAA9B,IAAoC,CAAC,CAF1B;AAG/BM,oBAAY,CAAC,CAACN,EAAF,IAAQC,MAAMC,KAAN,CAAYK,SAAZ,CAAsBF,OAAtB,CAA8BL,EAA9B,IAAoC,CAAC,CAH1B;AAI/BQ,kBAAU,CAAC,CAACR,EAAF,IAAQC,MAAMC,KAAN,CAAYO,OAAZ,CAAoBJ,OAApB,CAA4BL,EAA5B,IAAkC,CAAC;AAJtB,OAA1B;AADkB,KAApB,CAAP;AAQD,GATD;AAUD,CAXD;;AAaO,IAAIU,sBAAsB,8BAAeC,kCAAf,EAAoCC,iCAApC,EAAuDC,6BAAvD,EAAsEC,iCAAtE,EAAyFC,0BAAzF,EAAqGC,mCAArG,EAA2H,UAAUC,IAAV,EAAgBC,SAAhB,EAA2BC,KAA3B,EAAkC5B,SAAlC,EAA6C6B,EAA7C,EAAiDlB,KAAjD,EAAwD;AAClN,MAAI,CAACgB,SAAL,EAAgB;AACd,WAAO,IAAP;AACD;;AAED,MAAIjB,QAAQ;AACVoB,SAAKH,SADK;AAEVD,UAAMG,EAFI;AAGVD,WAAOA,KAHG;AAIV5B,eAAWA,SAJD;AAKVW,WAAOA;AALG,GAAZ;AAOA,SAAOH,gBAAgBkB,OAAOA,KAAKI,GAAZ,GAAkB,IAAlC,EAAwCpB,KAAxC,CAAP;AACD,CAbgC,CAA1B;;AAcA,IAAIqB,+BAA+B,8BAAe3B,mBAAf,EAAoCgB,kCAApC,EAAyDD,mBAAzD,EAA8E,UAAUd,OAAV,EAAmBqB,IAAnB,EAAyBM,OAAzB,EAAkC;AACxJ,MAAI7B,cAAcE,QAAQ4B,GAAR,CAAYzB,gBAAgBkB,OAAOA,KAAKI,GAAZ,GAAkB,IAAlC,CAAZ,CAAlB;;AAEA,MAAIE,OAAJ,EAAa;AACX7B,gBAAY+B,OAAZ,CAAoBF,OAApB;AACD;;AAED,SAAO7B,WAAP;AACD,CARyC,CAAnC,C,CASP","file":"roomHistorySelectors.js","sourcesContent":["import { createSelector } from 'reselect';\nimport { historyIDSelector, mediaSelector, startTimeSelector, djSelector } from './boothSelectors';\nimport { currentUserSelector } from './userSelectors';\nimport { currentVotesSelector } from './voteSelectors';\n\nconst byTimestamp = (a, b) => (a.timestamp < b.timestamp ? 1 : -1);\n\nconst baseSelector = state => state.roomHistory;\n\nexport const roomHistorySelector = createSelector(\n  baseSelector,\n  history => history.slice().sort(byTimestamp),\n);\n\nconst addOwnVoteProps = id => entry => ({\n  ...entry,\n  stats: {\n    ...entry.stats,\n    // No ID is provided for guest users.\n    isDownvote: !!id && entry.stats.downvotes.indexOf(id) > -1,\n    isFavorite: !!id && entry.stats.favorites.indexOf(id) > -1,\n    isUpvote: !!id && entry.stats.upvotes.indexOf(id) > -1,\n  },\n});\n\nexport const currentPlaySelector = createSelector(\n  currentUserSelector,\n  historyIDSelector,\n  mediaSelector,\n  startTimeSelector,\n  djSelector,\n  currentVotesSelector,\n  (user, historyID, media, timestamp, dj, stats) => {\n    if (!historyID) {\n      return null;\n    }\n    const entry = {\n      _id: historyID,\n      user: dj,\n      media,\n      timestamp,\n      stats,\n    };\n    return addOwnVoteProps(user ? user._id : null)(entry);\n  },\n);\n\nexport const roomHistoryWithVotesSelector = createSelector(\n  roomHistorySelector,\n  currentUserSelector,\n  currentPlaySelector,\n  (history, user, current) => {\n    const roomHistory = history.map(addOwnVoteProps(user ? user._id : null));\n    if (current) {\n      roomHistory.unshift(current);\n    }\n    return roomHistory;\n  },\n);\n"]}