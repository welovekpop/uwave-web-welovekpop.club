{"version":3,"sources":["selectors/chatSelectors.js"],"names":["baseSelector","state","chat","rawMotdSelector","motd","motdSelector","MAX_MESSAGES","allMessagesSelector","messages","filteredMessagesSelector","notificationSettingsSelector","notificationSettings","filter","message","type","userJoin","userLeave","userNameChanged","skip","messagesSelector","slice","markupCompilerOptionsSelector","availableEmoji","availableEmojiNamesSelector","emojiImages","availableEmojiImagesSelector","mutesSelector","mutedUsers","muteTimeoutsSelector","mutes","mute","expirationTimer","mutedUserIDsSelector","Object","keys","mutedUsersSelector","usersSelector","mutedIDs","users","map","userID","currentUserMuteSelector","currentUserSelector","user","_id","availableGroupMentionsSelector","currentUserHasRoleSelector","hasRole","mention","emojiCompletionsSelector","images","name","shortcode","image","canDeleteMessagesSelector"],"mappings":"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","file":"chatSelectors.js","sourcesContent":["import { createSelector, createStructuredSelector } from 'reselect';\nimport objMap from 'object.map';\nimport parseChatMarkup from 'u-wave-parse-chat-markup';\n\nimport { getAvailableGroupMentions } from '../utils/chatMentions';\nimport {\n  availableEmojiNamesSelector,\n  availableEmojiImagesSelector,\n} from './configSelectors';\nimport {\n  usersSelector,\n  currentUserSelector,\n  currentUserHasRoleSelector,\n  createRoleCheckSelector,\n} from './userSelectors';\nimport { notificationSettingsSelector } from './settingSelectors';\n\nconst baseSelector = state => state.chat;\n\nexport const rawMotdSelector = createSelector(baseSelector, chat => chat.motd);\nexport const motdSelector = createSelector(\n  rawMotdSelector,\n  motd => (motd ? parseChatMarkup(motd) : null),\n);\n\nconst MAX_MESSAGES = 500;\nconst allMessagesSelector = createSelector(baseSelector, chat => chat.messages);\nconst filteredMessagesSelector = createSelector(\n  allMessagesSelector,\n  notificationSettingsSelector,\n  (messages, notificationSettings) => messages.filter((message) => {\n    if (message.type === 'userJoin') return notificationSettings.userJoin;\n    if (message.type === 'userLeave') return notificationSettings.userLeave;\n    if (message.type === 'userNameChanged') return notificationSettings.userNameChanged;\n    if (message.type === 'skip') return notificationSettings.skip;\n    return true;\n  }),\n);\nexport const messagesSelector = createSelector(\n  filteredMessagesSelector,\n  messages => messages.slice(-MAX_MESSAGES),\n);\n\nexport const markupCompilerOptionsSelector = createStructuredSelector({\n  availableEmoji: availableEmojiNamesSelector,\n  emojiImages: availableEmojiImagesSelector,\n});\n\nconst mutesSelector = createSelector(baseSelector, chat => chat.mutedUsers);\n\nexport const muteTimeoutsSelector = createSelector(\n  mutesSelector,\n  mutes => objMap(mutes, mute => mute.expirationTimer),\n);\n\nexport const mutedUserIDsSelector = createSelector(\n  mutesSelector,\n  mutes => Object.keys(mutes),\n);\n\nexport const mutedUsersSelector = createSelector(\n  mutedUserIDsSelector,\n  usersSelector,\n  (mutedIDs, users) => mutedIDs.map(userID => users[userID]),\n);\n\nexport const currentUserMuteSelector = createSelector(\n  currentUserSelector,\n  mutesSelector,\n  (user, mutes) => (user ? mutes[user._id] : null),\n);\n\nexport const availableGroupMentionsSelector = createSelector(\n  currentUserHasRoleSelector,\n  hasRole => getAvailableGroupMentions(mention => hasRole(`chat.mention.${mention}`)),\n);\n\nexport const emojiCompletionsSelector = createSelector(\n  availableEmojiImagesSelector,\n  images => Object.keys(images).map(name => ({\n    shortcode: name,\n    image: images[name],\n  })),\n);\n\nexport const canDeleteMessagesSelector = createRoleCheckSelector('chat.delete');\n"]}