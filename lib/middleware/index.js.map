{"version":3,"sources":["middleware/index.js"],"names":["uwaveWebClient","uw","options","basePath","join","__dirname","fs","title","clientOptions","clientRouter","get","req","res","setHeader","transform","JSON","stringify","createReadStream","pipe","apiUrl","params","key","json","use"],"mappings":";;;;;kBAOwBA,c;;AAPxB;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEe,SAASA,cAAT,CAAwBC,EAAxB,EAA4BC,UAAU,EAAtC,EAA0C;AACvD,QAAM;AACJC,eAAW,eAAKC,IAAL,CAAUC,SAAV,EAAqB,cAArB,CADP;AAEJC,qBAFI,EAEY;AAChBC,YAAQ,OAHJ;AAIJ,OAAGC;AAJC,MAKFN,OALJ;;AAOA,QAAMO,eAAe,uBAArB;;AAEA,SAAOA,aAAaC,GAAb,CAAiB,GAAjB,EAAsB,CAACC,GAAD,EAAMC,GAAN,KAAc;AACzCA,QAAIC,SAAJ,CAAc,cAAd,EAA8B,WAA9B;;AAEA,UAAMC,YAAY,uBAAQ;AACxBP,WADwB;AAExB,wBAAkBQ,KAAKC,SAAL,CAAeR,aAAf;AAFM,KAAR,CAAlB;;AAKAF,OAAGW,gBAAH,CAAoB,eAAKb,IAAL,CAAUD,QAAV,EAAoB,YAApB,CAApB,EAAuD,MAAvD,EAA+De,IAA/D,CAAoEJ,SAApE,EAA+EI,IAA/E,CAAoF,6BAAKP,GAAL,EAAUC,GAAV,CAApF,EAAoGM,IAApG,CAAyGN,GAAzG;AACD,GATM,EASJF,GATI,CASA,aATA,EASe,CAACC,GAAD,EAAMC,GAAN,KAAc;AAClCA,QAAIC,SAAJ,CAAc,cAAd,EAA8B,WAA9B;;AAEA,UAAMC,YAAY,uBAAQ;AACxBP,WADwB;AAExB,wBAAkBQ,KAAKC,SAAL,CAAe,EAAEG,QAAQX,cAAcW,MAAxB,EAAf,CAFM;AAGxB,qBAAeR,IAAIS,MAAJ,CAAWC;AAHF,KAAR,CAAlB;;AAMAf,OAAGW,gBAAH,CAAoB,eAAKb,IAAL,CAAUD,QAAV,EAAoB,qBAApB,CAApB,EAAgE,MAAhE,EAAwEe,IAAxE,CAA6EJ,SAA7E,EAAwFI,IAAxF,CAA6F,6BAAKP,GAAL,EAAUC,GAAV,CAA7F,EAA6GM,IAA7G,CAAkHN,GAAlH;AACD,GAnBM,EAmBJF,GAnBI,CAmBA,yBAnBA,EAmB2B,CAACC,GAAD,EAAMC,GAAN,KAAc;AAC9CA,QAAIU,IAAJ,CAASd,aAAT;AACD,GArBM,EAqBJe,GArBI,CAqBA,iCAAYpB,QAAZ,CArBA,CAAP;AAsBD;AACD","file":"index.js","sourcesContent":["import path from 'path';\nimport defaultFs from 'fs';\nimport hstream from 'hstream';\nimport router from 'router';\nimport serveStatic from 'connect-gzip-static';\nimport gzip from 'http-gzip-maybe';\n\nexport default function uwaveWebClient(uw, options = {}) {\n  const {\n    basePath = path.join(__dirname, '../../public'),\n    fs = defaultFs, // Should only be used by the dev server.\n    title = 'Ã¼Wave',\n    ...clientOptions\n  } = options;\n\n  const clientRouter = router();\n\n  return clientRouter\n    .get('/', (req, res) => {\n      res.setHeader('content-type', 'text/html');\n\n      const transform = hstream({\n        title,\n        '#u-wave-config': JSON.stringify(clientOptions),\n      });\n\n      fs.createReadStream(path.join(basePath, 'index.html'), 'utf8')\n        .pipe(transform)\n        .pipe(gzip(req, res))\n        .pipe(res);\n    })\n    .get('/reset/:key', (req, res) => {\n      res.setHeader('content-type', 'text/html');\n\n      const transform = hstream({\n        title,\n        '#u-wave-config': JSON.stringify({ apiUrl: clientOptions.apiUrl }),\n        '#reset-data': req.params.key,\n      });\n\n      fs.createReadStream(path.join(basePath, 'password-reset.html'), 'utf8')\n        .pipe(transform)\n        .pipe(gzip(req, res))\n        .pipe(res);\n    })\n    .get('/u-wave-web-config.json', (req, res) => {\n      res.json(clientOptions);\n    })\n    .use(serveStatic(basePath));\n}\n"]}