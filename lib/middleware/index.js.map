{"version":3,"sources":["middleware/index.js"],"names":["uwaveWebClient","uw","options","basePath","path","join","__dirname","fs","defaultFs","title","clientOptions","clientRouter","get","req","res","setHeader","transform","JSON","stringify","createReadStream","pipe","apiUrl","params","key","json","use"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;AACe,SAASA,cAAT,CAAwBC,EAAxB,EAA4BC,UAAU,EAAtC,EAA0C;AACvD,QAAM;AACJC,eAAWC,cAAKC,IAAL,CAAUC,SAAV,EAAqB,cAArB,CADP;AAEJC,SAAKC,WAFD;AAGJ;AACAC,YAAQ,OAJJ;AAKJ,OAAGC;AALC,MAMFR,OANJ;AAOA,QAAMS,eAAe,sBAArB;AACA,SAAOA,aAAaC,GAAb,CAAiB,GAAjB,EAAsB,CAACC,GAAD,EAAMC,GAAN,KAAc;AACzCA,QAAIC,SAAJ,CAAc,cAAd,EAA8B,WAA9B;AACA,UAAMC,YAAY,sBAAQ;AACxBP,WADwB;AAExB,wBAAkBQ,KAAKC,SAAL,CAAeR,aAAf;AAFM,KAAR,CAAlB;AAIAH,OAAGY,gBAAH,CAAoBf,cAAKC,IAAL,CAAUF,QAAV,EAAoB,YAApB,CAApB,EAAuD,MAAvD,EAA+DiB,IAA/D,CAAoEJ,SAApE,EAA+EI,IAA/E,CAAoF,4BAAKP,GAAL,EAAUC,GAAV,CAApF,EAAoGM,IAApG,CAAyGN,GAAzG;AACD,GAPM,EAOJF,GAPI,CAOA,aAPA,EAOe,CAACC,GAAD,EAAMC,GAAN,KAAc;AAClCA,QAAIC,SAAJ,CAAc,cAAd,EAA8B,WAA9B;AACA,UAAMC,YAAY,sBAAQ;AACxBP,WADwB;AAExB,wBAAkBQ,KAAKC,SAAL,CAAe;AAC/BG,gBAAQX,cAAcW;AADS,OAAf,CAFM;AAKxB,qBAAeR,IAAIS,MAAJ,CAAWC;AALF,KAAR,CAAlB;AAOAhB,OAAGY,gBAAH,CAAoBf,cAAKC,IAAL,CAAUF,QAAV,EAAoB,qBAApB,CAApB,EAAgE,MAAhE,EAAwEiB,IAAxE,CAA6EJ,SAA7E,EAAwFI,IAAxF,CAA6F,4BAAKP,GAAL,EAAUC,GAAV,CAA7F,EAA6GM,IAA7G,CAAkHN,GAAlH;AACD,GAjBM,EAiBJF,GAjBI,CAiBA,yBAjBA,EAiB2B,CAACC,GAAD,EAAMC,GAAN,KAAc;AAC9CA,QAAIU,IAAJ,CAASd,aAAT;AACD,GAnBM,EAmBJe,GAnBI,CAmBA,gCAAYtB,QAAZ,CAnBA,CAAP;AAoBD","file":"index.js","sourcesContent":["import path from 'path';\nimport defaultFs from 'fs';\nimport hstream from 'hstream';\nimport router from 'router';\nimport serveStatic from 'connect-gzip-static';\nimport gzip from 'http-gzip-maybe';\n\nexport default function uwaveWebClient(uw, options = {}) {\n  const {\n    basePath = path.join(__dirname, '../../public'),\n    fs = defaultFs, // Should only be used by the dev server.\n    title = 'Ã¼Wave',\n    ...clientOptions\n  } = options;\n\n  const clientRouter = router();\n\n  return clientRouter\n    .get('/', (req, res) => {\n      res.setHeader('content-type', 'text/html');\n\n      const transform = hstream({\n        title,\n        '#u-wave-config': JSON.stringify(clientOptions),\n      });\n\n      fs.createReadStream(path.join(basePath, 'index.html'), 'utf8')\n        .pipe(transform)\n        .pipe(gzip(req, res))\n        .pipe(res);\n    })\n    .get('/reset/:key', (req, res) => {\n      res.setHeader('content-type', 'text/html');\n\n      const transform = hstream({\n        title,\n        '#u-wave-config': JSON.stringify({ apiUrl: clientOptions.apiUrl }),\n        '#reset-data': req.params.key,\n      });\n\n      fs.createReadStream(path.join(basePath, 'password-reset.html'), 'utf8')\n        .pipe(transform)\n        .pipe(gzip(req, res))\n        .pipe(res);\n    })\n    .get('/u-wave-web-config.json', (req, res) => {\n      res.json(clientOptions);\n    })\n    .use(serveStatic(basePath));\n}\n"]}