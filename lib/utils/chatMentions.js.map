{"version":3,"sources":["utils/chatMentions.js"],"names":["getAvailableGroupMentions","resolveMentions","hasMention","groupMentions","canMention","Object","keys","filter","tree","state","users","forEach","node","type","groupSelector","mention","group","user","username","toLowerCase","content","id","some","_id","Array","isArray"],"mappings":";;;;;;QAWgBA,yB,GAAAA,yB;QAaAC,e,GAAAA,e;QA2BAC,U,GAAAA,U;;AAnDhB;;;;AACA;;AACA;;IAAYC,a;;;;;;QAEHA,a,GAAAA,a;;AAET;;;;;;AAKO,SAASH,yBAAT,CAAmCI,UAAnC,EAA+C;AACpD,MAAIA,UAAJ,EAAgB;AACd,WAAOC,OAAOC,IAAP,CAAYH,aAAZ,EAA2BI,MAA3B,CAAkCH,UAAlC,CAAP;AACD;AACD,SAAO,EAAP;AACD;;AAED;;;;;;AAMO,SAASH,eAAT,CAAyBO,IAAzB,EAA+BC,KAA/B,EAAsC;AAC3C,MAAIC,QAAQ,qCAAiBD,KAAjB,CAAZ;AACAD,OAAKG,OAAL,CAAa,UAAUC,IAAV,EAAgB;AAC3B,QAAIA,KAAKC,IAAL,KAAc,SAAlB,EAA6B;AAC3B,UAAIC,gBAAgBX,cAAcS,KAAKG,OAAnB,CAApB;AACA;AACA,UAAID,aAAJ,EAAmB;AACjBF,aAAKI,KAAL,GAAaF,cAAcL,KAAd,CAAb;AACD,OAFD,MAEO;AACLG,aAAKK,IAAL,GAAY,oBAAKP,KAAL,EAAY,UAAUO,IAAV,EAAgB;AACtC,iBAAOA,KAAKC,QAAL,CAAcC,WAAd,OAAgCP,KAAKG,OAA5C;AACD,SAFW,CAAZ;AAGD;AACD;AACD,KAXD,MAWO,IAAIH,KAAKQ,OAAT,EAAkB;AACvBnB,sBAAgBW,KAAKQ,OAArB,EAA8BX,KAA9B;AACD;AACF,GAfD;AAgBD;;AAED;;;;;;;AAOO,SAASP,UAAT,CAAoBM,IAApB,EAA0Ba,EAA1B,EAA8B;AACnC,SAAOb,KAAKc,IAAL,CAAU,UAAUV,IAAV,EAAgB;AAC/B,QAAIA,KAAKC,IAAL,KAAc,SAAlB,EAA6B;AAC3B,UAAID,KAAKK,IAAT,EAAe;AACb,eAAOL,KAAKK,IAAL,CAAUM,GAAV,KAAkBF,EAAzB;AACD,OAFD,MAEO,IAAIT,KAAKI,KAAT,EAAgB;AACrB,eAAOJ,KAAKI,KAAL,CAAWM,IAAX,CAAgB,UAAUL,IAAV,EAAgB;AACrC,iBAAOA,KAAKM,GAAL,KAAaF,EAApB;AACD,SAFM,CAAP;AAGD;AACD,aAAO,KAAP;AACD;AACD,WAAOG,MAAMC,OAAN,CAAcb,IAAd,KAAuBV,WAAWU,IAAX,EAAiBS,EAAjB,CAA9B;AACD,GAZM,CAAP;AAaD;AACD","file":"chatMentions.js","sourcesContent":["import find from 'lodash/find';\nimport { userListSelector } from '../selectors/userSelectors';\nimport * as groupMentions from './groupMentions';\n\nexport { groupMentions };\n\n/**\n * Get a list of group names that can be mentioned by a user.\n *\n * @param {function(role: string): boolean} canMention\n */\nexport function getAvailableGroupMentions(canMention) {\n  if (canMention) {\n    return Object.keys(groupMentions).filter(canMention);\n  }\n  return [];\n}\n\n/**\n * Attach user objects to mentions in a parsed chat message.\n *\n * @param {Array} tree Parsed message.\n * @param {Array.<{username: string}>} users List of users.\n */\nexport function resolveMentions(tree, state) {\n  const users = userListSelector(state);\n  tree.forEach((node) => {\n    if (node.type === 'mention') {\n      const groupSelector = groupMentions[node.mention];\n      /* eslint-disable no-param-reassign */\n      if (groupSelector) {\n        node.group = groupSelector(state);\n      } else {\n        node.user = find(users, user => user.username.toLowerCase() === node.mention);\n      }\n      /* eslint-enable no-param-reassign */\n    } else if (node.content) {\n      resolveMentions(node.content, state);\n    }\n  });\n}\n\n/**\n * Check whether a parsed chat message mentions a given user ID. Expects mention\n * nodes to have User data, added by `resolveMentions()`.\n *\n * @param {Array} tree Parsed message.\n * @param {String} id User ID.\n */\nexport function hasMention(tree, id) {\n  return tree.some((node) => {\n    if (node.type === 'mention') {\n      if (node.user) {\n        return node.user._id === id;\n      } else if (node.group) {\n        return node.group.some(user => user._id === id);\n      }\n      return false;\n    }\n    return Array.isArray(node) && hasMention(node, id);\n  });\n}\n"]}