{"version":3,"sources":["middleware.js"],"names":["uwaveWebClient","path","defaultFs","injectConfig","config","transform","trumpet","select","createWriteStream","end","JSON","stringify","uw","options","arguments","length","undefined","_options$basePath","basePath","join","__dirname","_options$fs","fs","clientOptions","clientRouter","router","mobile","req","res","createReadStream","pipe","get","use","serveStatic"],"mappings":";;;;;kBAcwBA,c;;AAdxB;;;;AAAA;;IAAYC,I;;AACZ;;IAAYC,S;;AACZ;;;;AACA;;;;AACA;;;;;;;;AAEA,SAASC,YAAT,CAAsBC,MAAtB,EAA8B;AAC5B,MAAMC,YAAYC,wBAAlB;AACAD,YAAUE,MAAVF,CAAiB,gBAAjBA,EACGG,iBADHH,GAEGI,GAFHJ,CAEOK,KAAKC,SAALD,CAAeN,MAAfM,CAFPL;AAGA,SAAOA,SAAP;AACD;;AAEc,SAASL,cAAT,CAAwBY,EAAxB,EAA0C;AAAA,MAAdC,UAAcC,UAAAC,MAAA,GAAA,CAAA,IAAAD,UAAA,CAAA,MAAAE,SAAA,GAAAF,UAAA,CAAA,CAAA,GAAJ,EAAI;;AAAA,MAAAG,oBAKnDJ,QAHFK,QAFqD;AAAA,MAErDA,WAFqDD,sBAAAD,SAAA,GAE1Cf,KAAKkB,IAALlB,CAAUmB,SAAVnB,EAAqB,WAArBA,CAF0C,GAAAgB,iBAAA;AAAA,MAAAI,cAKnDR,QAFFS,EAHqD;AAAA,MAGrDA,KAHqDD,gBAAAL,SAAA,GAGhDd,SAHgD,GAAAmB,WAAA;AAAA,MAIlDE,gBAJkD,uCAKnDV,OALmD,EAAA,CAAA,UAAA,EAAA,IAAA,CAAA,CAAA;;AAOvD,MAAMW,eAAeC,uBAArB;;AAEA,MAAMC,SAAS,SAATA,MAAS,CAACC,GAAD,EAAMC,GAAN,EAAc;AAC3BN,OAAGO,gBAAHP,CAAoBrB,KAAKkB,IAALlB,CAAUiB,QAAVjB,EAAoB,QAApBA,CAApBqB,EAAmD,MAAnDA,EACGQ,IADHR,CACQnB,aAAaoB,aAAbpB,CADRmB,EAEGQ,IAFHR,CAEQM,GAFRN;AADF,GAAA;;AAMA,SAAOE,aACJO,GADIP,CACA,GADAA,EACK,UAACG,GAAD,EAAMC,GAAN,EAAc;AACtBN,OAAGO,gBAAHP,CAAoBrB,KAAKkB,IAALlB,CAAUiB,QAAVjB,EAAoB,YAApBA,CAApBqB,EAAuD,MAAvDA,EACGQ,IADHR,CACQnB,aAAaoB,aAAbpB,CADRmB,EAEGQ,IAFHR,CAEQM,GAFRN;AAFG,GAAAE,EAMJO,GANIP,CAMA,IANAA,EAMME,MANNF,EAOJO,GAPIP,CAOA,SAPAA,EAOWE,MAPXF,EAQJQ,GARIR,CAQAS,2BAAYf,QAAZe,CARAT,CAAP;AASD;AAND","file":"middleware.js","sourcesContent":["import * as path from 'path';\nimport * as defaultFs from 'fs';\nimport trumpet from 'trumpet';\nimport router from 'router';\nimport serveStatic from 'serve-static';\n\nfunction injectConfig(config) {\n  const transform = trumpet();\n  transform.select('#u-wave-config')\n    .createWriteStream()\n    .end(JSON.stringify(config));\n  return transform;\n}\n\nexport default function uwaveWebClient(uw, options = {}) {\n  const {\n    basePath = path.join(__dirname, '../public'),\n    fs = defaultFs, // Should only be used by the dev server.\n    ...clientOptions\n  } = options;\n\n  const clientRouter = router();\n\n  const mobile = (req, res) => {\n    fs.createReadStream(path.join(basePath, 'm.html'), 'utf8')\n      .pipe(injectConfig(clientOptions))\n      .pipe(res);\n  };\n\n  return clientRouter\n    .get('/', (req, res) => {\n      fs.createReadStream(path.join(basePath, 'index.html'), 'utf8')\n        .pipe(injectConfig(clientOptions))\n        .pipe(res);\n    })\n    .get('/m', mobile)\n    .get('/m.html', mobile)\n    .use(serveStatic(basePath));\n}\n"]}