{"version":3,"sources":["middleware.js"],"names":["uwaveWebClient","path","defaultFs","injectConfig","transform","config","select","createWriteStream","end","JSON","stringify","injectTitle","title","injectResetKey","key","uw","options","arguments","length","undefined","_options$basePath","basePath","join","__dirname","_options$fs","fs","_options$title","clientOptions","clientRouter","router","mobile","req","res","trumpet","createReadStream","pipe","get","apiUrl","params","json","use","serveStatic"],"mappings":"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","file":"middleware.js","sourcesContent":["import * as path from 'path';\nimport * as defaultFs from 'fs';\nimport trumpet from 'trumpet';\nimport router from 'router';\nimport serveStatic from 'connect-gzip-static';\n\nfunction injectConfig(transform, config) {\n  transform.select('#u-wave-config')\n    .createWriteStream()\n    .end(JSON.stringify(config));\n}\n\nfunction injectTitle(transform, title) {\n  transform.select('title')\n    .createWriteStream()\n    .end(title);\n}\n\nfunction injectResetKey(transform, key) {\n  transform.select('#reset-data')\n    .createWriteStream()\n    .end(key);\n}\n\nexport default function uwaveWebClient(uw, options = {}) {\n  const {\n    basePath = path.join(__dirname, '../public'),\n    fs = defaultFs, // Should only be used by the dev server.\n    title = 'Ã¼Wave',\n    ...clientOptions\n  } = options;\n\n  const clientRouter = router();\n\n  const mobile = (req, res) => {\n    const transform = trumpet();\n    injectTitle(transform, title);\n    injectConfig(transform, clientOptions);\n\n    fs.createReadStream(path.join(basePath, 'm.html'), 'utf8')\n      .pipe(transform)\n      .pipe(res);\n  };\n\n  return clientRouter\n    .get('/', (req, res) => {\n      const transform = trumpet();\n      injectTitle(transform, title);\n      injectConfig(transform, clientOptions);\n\n      fs.createReadStream(path.join(basePath, 'index.html'), 'utf8')\n        .pipe(transform)\n        .pipe(res);\n    })\n    .get('/reset/:key', (req, res) => {\n      const transform = trumpet();\n      injectTitle(transform, title);\n      injectConfig(transform, { apiUrl: clientOptions.apiUrl });\n      injectResetKey(transform, req.params.key);\n\n      fs.createReadStream(path.join(basePath, 'password-reset.html'), 'utf8')\n        .pipe(transform)\n        .pipe(res);\n    })\n    .get('/m', mobile)\n    .get('/m.html', mobile)\n    .get('/u-wave-web-config.json', (req, res) => {\n      res.json(clientOptions);\n    })\n    .use(serveStatic(basePath));\n}\n"]}