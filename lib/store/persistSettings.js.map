{"version":3,"sources":["store/persistSettings.js"],"names":["SETTINGS_KEY","attempt","fn","undefined","e","persistSettings","next","reducer","initialState","settings","JSON","parse","localStorage","getItem","store","dispatch","prevSettings","subscribe","newSettings","getState","setItem","stringify"],"mappings":";;;;;;AAAA;;;;AACA;;;;AAEA,IAAIA,eAAe,eAAnB;;AAEA,IAAIC,UAAU,SAASA,OAAT,CAAiBC,EAAjB,EAAqB;AACjC,MAAI;AACF,WAAOA,QAAQC,SAAf;AACD,GAFD,CAEE,OAAOC,CAAP,EAAU;AACV,WAAOD,SAAP;AACD;AACF,CAND;;AAQA;AACA;AACA;AACA;AACA,IAAIE,kBAAkB,SAASA,eAAT,CAAyBC,IAAzB,EAA+B;AACnD,SAAO,UAAUC,OAAV,EAAmBC,YAAnB,EAAiC;AACtC,QAAIC,WAAWR,QAAQ,YAAY;AACjC,aAAOS,KAAKC,KAAL,CAAWC,aAAaC,OAAb,CAAqBb,YAArB,CAAX,CAAP;AACD,KAFc,CAAf;;AAIA,QAAIc,QAAQR,KAAKC,OAAL,EAAcC,YAAd,CAAZ;;AAEAM,UAAMC,QAAN,CAAe,0CAAaN,QAAb,CAAf;;AAEA,QAAIO,eAAeP,QAAnB;AACAK,UAAMG,SAAN,CAAgB,YAAY;AAC1B,UAAIC,cAAcJ,MAAMK,QAAN,GAAiBV,QAAnC;AACA,UAAI,CAAC,8BAAQO,YAAR,EAAsBE,WAAtB,CAAL,EAAyC;AACvCjB,gBAAQ,YAAY;AAClB,iBAAOW,aAAaQ,OAAb,CAAqBpB,YAArB,EAAmCU,KAAKW,SAAL,CAAeH,WAAf,CAAnC,CAAP;AACD,SAFD;AAGD;AACDF,qBAAeE,WAAf;AACD,KARD;AASA,WAAOJ,KAAP;AACD,GApBD;AAqBD,CAtBD;;kBAwBeT,e;AACf","file":"persistSettings.js","sourcesContent":["import isEqual from 'is-equal-shallow';\nimport { loadSettings } from '../actions/SettingsActionCreators';\n\nconst SETTINGS_KEY = 'uwaveSettings';\n\nconst attempt = (fn) => {\n  try {\n    return fn() || undefined;\n  } catch (e) {\n    return undefined;\n  }\n};\n\n// [Store enhancer][1] that saves and loads app settings to and from\n// localStorage.\n//\n// [1]: http://redux.js.org/docs/Glossary.html#store-enhancer\nconst persistSettings = next => (reducer, initialState) => {\n  const settings = attempt(() =>\n    JSON.parse(localStorage.getItem(SETTINGS_KEY))\n  );\n\n  const store = next(reducer, initialState);\n\n  store.dispatch(loadSettings(settings));\n\n  let prevSettings = settings;\n  store.subscribe(() => {\n    const newSettings = store.getState().settings;\n    if (!isEqual(prevSettings, newSettings)) {\n      attempt(() =>\n        localStorage.setItem(SETTINGS_KEY, JSON.stringify(newSettings))\n      );\n    }\n    prevSettings = newSettings;\n  });\n  return store;\n};\n\nexport default persistSettings;\n"]}