{"version":3,"sources":["components/Chat/ChatMessages.js"],"names":["ChatMessages","_React$Component","_temp","_this","_len","arguments","length","args","Array","_key","call","apply","concat","state","isScrolledToBottom","onExternalScroll","direction","el","container","scrollTop","scrollHeight","handleResize","scrollToBottom","handleScroll","setState","handleScrollToBottom","event","preventDefault","refContainer","_proto","prototype","componentDidMount","bus","props","shouldScrollToBottom","on","window","addEventListener","componentWillReceiveProps","componentDidUpdate","componentWillUnmount","off","removeEventListener","lastMessage","lastElementChild","neededSize","offsetHeight","renderMotd","motd","Motd","compileOptions","renderMessage","msg","SpecialMessage","specialMessages","type","React","createElement","key","_id","Message","deletable","canDeleteMessages","onDelete","onDeleteMessage","render","ref","className","onScroll","ScrollDownNotice","show","onClick","messages","map","Component","propTypes","process","env","NODE_ENV","PropTypes","object","isRequired","array","bool","func","shape","availableEmoji","emojiImages"],"mappings":"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","file":"ChatMessages.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport Message from './Message';\nimport Motd from './Motd';\nimport ScrollDownNotice from './ScrollDownNotice';\nimport specialMessages from './specialMessages';\n\nexport default class ChatMessages extends React.Component {\n  static propTypes = {\n    bus: PropTypes.object.isRequired,\n    messages: PropTypes.array,\n    motd: PropTypes.array,\n    canDeleteMessages: PropTypes.bool,\n    onDeleteMessage: PropTypes.func,\n    compileOptions: PropTypes.shape({\n      availableEmoji: PropTypes.array,\n      emojiImages: PropTypes.object,\n    }),\n  };\n\n  state = {\n    isScrolledToBottom: true,\n  };\n\n  componentDidMount() {\n    const { bus } = this.props;\n\n    this.scrollToBottom();\n    this.shouldScrollToBottom = false;\n\n    bus.on('chat:scroll', this.onExternalScroll);\n\n    // A window resize may affect the available space.\n    if (typeof window !== 'undefined') {\n      window.addEventListener('resize', this.handleResize);\n    }\n  }\n\n  componentWillReceiveProps() {\n    this.shouldScrollToBottom = this.isScrolledToBottom();\n  }\n\n  componentDidUpdate() {\n    // Keep the chat scrolled to the bottom after a new message is addded.\n    if (this.shouldScrollToBottom) {\n      this.scrollToBottom();\n      this.shouldScrollToBottom = false;\n    }\n  }\n\n  componentWillUnmount() {\n    const { bus } = this.props;\n\n    bus.off('chat:scroll', this.onExternalScroll);\n\n    if (typeof window !== 'undefined') {\n      window.removeEventListener('resize', this.handleResize);\n    }\n  }\n\n  onExternalScroll = (direction) => {\n    const el = this.container;\n    if (direction === 'start') {\n      el.scrollTop = 0;\n    } else if (direction === 'end') {\n      el.scrollTop = el.scrollHeight;\n    } else {\n      el.scrollTop += direction * 250;\n    }\n  };\n\n  scrollToBottom() {\n    const el = this.container;\n    el.scrollTop = el.scrollHeight;\n  }\n\n  isScrolledToBottom() {\n    const el = this.container;\n    const lastMessage = el.lastElementChild;\n    if (lastMessage) {\n      const neededSize = el.scrollTop + el.offsetHeight + lastMessage.offsetHeight;\n      return neededSize >= el.scrollHeight - 20;\n    }\n    return true;\n  }\n\n  handleResize = () => {\n    if (this.state.isScrolledToBottom) {\n      this.scrollToBottom();\n    }\n  };\n\n  handleScroll = () => {\n    this.setState({\n      isScrolledToBottom: this.isScrolledToBottom(),\n    });\n  };\n\n  handleScrollToBottom = (event) => {\n    event.preventDefault();\n    this.scrollToBottom();\n  };\n\n  refContainer = (container) => {\n    this.container = container;\n  };\n\n  renderMotd() {\n    if (!this.props.motd) {\n      return null;\n    }\n    return (\n      <Motd compileOptions={this.props.compileOptions}>\n        {this.props.motd}\n      </Motd>\n    );\n  }\n\n  renderMessage(msg) {\n    const SpecialMessage = specialMessages[msg.type];\n    if (SpecialMessage) {\n      return (\n        <SpecialMessage\n          key={msg._id}\n          {...msg}\n        />\n      );\n    }\n\n    return (\n      <Message\n        key={msg._id}\n        compileOptions={this.props.compileOptions}\n        deletable={this.props.canDeleteMessages}\n        onDelete={this.props.onDeleteMessage}\n        {...msg}\n      />\n    );\n  }\n\n  render() {\n    const { isScrolledToBottom } = this.state;\n\n    return (\n      <div\n        ref={this.refContainer}\n        className=\"ChatMessages\"\n        onScroll={this.handleScroll}\n      >\n        <ScrollDownNotice\n          show={!isScrolledToBottom}\n          onClick={this.handleScrollToBottom}\n        />\n        {this.renderMotd()}\n        {this.props.messages.map(this.renderMessage, this)}\n      </div>\n    );\n  }\n}\n"]}