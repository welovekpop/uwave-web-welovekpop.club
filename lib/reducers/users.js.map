{"version":3,"sources":["reducers/users.js"],"names":["updateUser","state","userID","update","_objectSpread2","guestsReducer","action","type","INIT_STATE","payload","guests","RECEIVE_GUEST_COUNT","usersReducer","_objectSpread3","_action","LOAD_ONLINE_USERS","users","USER_JOIN","user","_id","USER_LEAVE","CHANGE_USERNAME","username","USER_ADD_ROLES","roles","concat","USER_REMOVE_ROLES","filter","role","indexOf","reduce"],"mappings":"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","file":"users.js","sourcesContent":["import except from 'except';\nimport indexBy from 'index-by';\nimport { combineReducers } from 'redux';\n\nimport { INIT_STATE } from '../constants/actionTypes/auth';\nimport {\n  LOAD_ONLINE_USERS,\n  USER_JOIN,\n  USER_LEAVE,\n  CHANGE_USERNAME,\n  USER_ADD_ROLES,\n  USER_REMOVE_ROLES,\n\n  RECEIVE_GUEST_COUNT,\n} from '../constants/actionTypes/users';\n\nfunction updateUser(state, userID, update) {\n  if (state[userID]) {\n    return {\n      ...state,\n      [userID]: update(state[userID]),\n    };\n  }\n  return state;\n}\n\nfunction guestsReducer(state = 0, action = {}) {\n  if (action.type === INIT_STATE) {\n    return action.payload.guests;\n  }\n  if (action.type === RECEIVE_GUEST_COUNT) {\n    return action.payload.guests;\n  }\n  return state;\n}\n\nfunction usersReducer(state = {}, action = {}) {\n  const { type, payload } = action;\n  switch (type) {\n    case LOAD_ONLINE_USERS:\n    // this is merged in instead of replacing the state, because sometimes the\n    // JOIN event from the current user comes in before the LOAD event, and then\n    // the current user is sometimes excluded from the state. it looks like this\n    // approach could cause problems, too, though.\n    // TODO maybe replace state instead anyway and merge in the current user?\n      return {\n        ...state,\n        ...indexBy(payload.users, '_id'),\n      };\n    case USER_JOIN:\n      return {\n        ...state,\n        [payload.user._id]: payload.user,\n      };\n    case USER_LEAVE:\n      return except(state, payload.userID);\n    case CHANGE_USERNAME:\n      return updateUser(state, payload.userID, user => ({\n        ...user,\n        username: payload.username,\n      }));\n    case USER_ADD_ROLES:\n      return updateUser(state, payload.userID, user => ({\n        ...user,\n        roles: [...user.roles, ...payload.roles],\n      }));\n    case USER_REMOVE_ROLES:\n      return updateUser(state, payload.userID, user => ({\n        ...user,\n        roles: user.roles.filter(role => payload.roles.indexOf(role) === -1),\n      }));\n    default:\n      return state;\n  }\n}\n\nconst reduce = combineReducers({\n  guests: guestsReducer,\n  users: usersReducer,\n});\n\nexport default reduce;\n"]}