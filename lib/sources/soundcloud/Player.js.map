{"version":3,"sources":["sources/soundcloud/Player.js"],"names":["debug","CLIENT_ID","getErrorMessage","err","name","code","test","message","enhance","_ref","ErrorIcon","className","_ref2","src","soundcloudLogo","alt","SoundCloudPlayer","_React$Component","_temp","_this","_len","arguments","length","args","Array","_key","call","apply","concat","state","error","needsTap","handleError","setState","handlePlay","play","_proto","prototype","componentDidMount","_this2","audio","Audio","addEventListener","autoplay","componentDidUpdate","prevProps","volume","props","media","sourceID","enabled","active","stop","componentWillUnmount","_this3","doSeek","currentTime","seek","start","removeEventListener","streamUrl","sourceData","res","then","catch","pause","render","_props","t","_state","Paper","Typography","component","paragraph","Button","variant","color","onClick","defaultValue","thumbnail","SongInfo","artist","username","title","fullTitle","artistUrl","trackUrl","permalinkUrl","href","target","rel","React","Component","propTypes","process","env","NODE_ENV","PropTypes","func","isRequired","string","bool","object","number"],"mappings":"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","file":"Player.js","sourcesContent":["import cx from 'classnames';\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport createDebug from 'debug';\nimport { translate } from 'react-i18next';\nimport Paper from 'material-ui/Paper';\nimport Button from 'material-ui/Button';\nimport Typography from 'material-ui/Typography';\nimport ErrorIcon from '@material-ui/icons/Error';\nimport SongInfo from './SongInfo';\nimport soundcloudLogo from '../../../assets/img/soundcloud-inline.png';\n\nconst debug = createDebug('uwave:component:video:soundcloud');\n\nconst CLIENT_ID = '9d883cdd4c3c54c6dddda2a5b3a11200';\n\nfunction getErrorMessage(err) {\n  if (err.name === 'MediaError') {\n    if (err.code === 2) {\n      return 'soundcloud.error.network';\n    }\n    if (err.code === 3) {\n      return 'soundcloud.error.decode';\n    }\n    if (err.code === 4 && /404|not found/i.test(err.message)) {\n      return 'soundcloud.error.notFound';\n    }\n  }\n  return err.message;\n}\n\nconst enhance = translate();\n\nclass SoundCloudPlayer extends React.Component {\n  static propTypes = {\n    t: PropTypes.func.isRequired,\n    className: PropTypes.string,\n    active: PropTypes.bool.isRequired,\n    enabled: PropTypes.bool,\n    media: PropTypes.object,\n    seek: PropTypes.number,\n    volume: PropTypes.number,\n  };\n\n  state = {\n    error: null,\n    needsTap: false,\n  };\n\n  componentDidMount() {\n    this.audio = new Audio();\n    this.audio.addEventListener('error', () => {\n      this.handleError(this.audio.error);\n    });\n    this.audio.autoplay = true;\n    this.play();\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.volume !== this.props.volume) {\n      this.audio.volume = this.props.volume / 100;\n    }\n    if (prevProps.media.sourceID !== this.props.media.sourceID ||\n        prevProps.enabled !== this.props.enabled ||\n        prevProps.active !== this.props.active) {\n      if (this.props.enabled && this.props.active) {\n        this.play();\n      } else {\n        this.stop();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    this.stop();\n  }\n\n  play() {\n    this.setState({ needsTap: false, error: null });\n    if (this.props.enabled && this.props.active) {\n      // In Firefox we have to wait for the \"canplaythrough\" event before\n      // seeking.\n      // http://stackoverflow.com/a/34970444\n      const doSeek = () => {\n        this.audio.currentTime = this.props.seek + (this.props.media.start || 0);\n        this.audio.volume = this.props.volume / 100;\n        this.audio.removeEventListener('canplaythrough', doSeek, false);\n      };\n\n      const { streamUrl } = this.props.media.sourceData;\n      this.audio.src = `${streamUrl}?client_id=${CLIENT_ID}`;\n      const res = this.audio.play();\n      if (res && res.then) res.catch(this.handleError);\n      debug('currentTime', this.props.seek);\n      this.audio.addEventListener('canplaythrough', doSeek, false);\n    } else {\n      this.stop();\n    }\n  }\n\n  stop() {\n    this.setState({ error: null });\n    this.audio.pause();\n  }\n\n  handleError = (error) => {\n    this.setState({\n      error,\n      needsTap: error.name === 'NotAllowedError',\n    });\n  };\n\n  handlePlay = () => {\n    this.play();\n  };\n\n  render() {\n    if (!this.props.active) {\n      return null;\n    }\n\n    const { t, media } = this.props;\n    const { error, needsTap } = this.state;\n    const { sourceData } = media;\n    if (!sourceData) {\n      return <div className={cx('src-soundcloud-Player', this.props.className)} />;\n    }\n\n    if (needsTap) {\n      return (\n        <div className={cx('src-soundcloud-Player', this.props.className)}>\n          <Paper className=\"src-soundcloud-Player-message\">\n            <Typography component=\"p\" paragraph>\n              {t('booth.autoplayBlocked')}\n            </Typography>\n            <Button variant=\"raised\" color=\"primary\" onClick={this.handlePlay}>\n              {t('booth.play')}\n            </Button>\n          </Paper>\n        </div>\n      );\n    }\n\n    if (error) {\n      return (\n        <div className={cx('src-soundcloud-Player', this.props.className)}>\n          <Paper className=\"src-soundcloud-Player-error\">\n            <ErrorIcon className=\"src-soundcloud-Player-errorIcon\" />\n            <Typography component=\"p\">\n              {t('soundcloud.error.template', {\n                error: t(getErrorMessage(error), { defaultValue: error.message }),\n              })}\n            </Typography>\n          </Paper>\n        </div>\n      );\n    }\n\n    return (\n      <div className={cx('src-soundcloud-Player', this.props.className)}>\n        <div className=\"src-soundcloud-Player-meta\">\n          <div className=\"src-soundcloud-Player-info\">\n            <img\n              className=\"src-soundcloud-Player-art\"\n              src={media.thumbnail}\n              alt=\"\"\n            />\n            <div className=\"src-soundcloud-Player-links\">\n              <SongInfo\n                artist={sourceData.username}\n                title={sourceData.fullTitle}\n                artistUrl={sourceData.artistUrl}\n                trackUrl={sourceData.permalinkUrl}\n              />\n            </div>\n          </div>\n          <a\n            href={sourceData.permalinkUrl}\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className=\"src-soundcloud-Player-permalink\"\n          >\n            View on{' '}\n            <img\n              src={soundcloudLogo}\n              alt=\"SoundCloud\"\n            />\n          </a>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default enhance(SoundCloudPlayer);\n"]}