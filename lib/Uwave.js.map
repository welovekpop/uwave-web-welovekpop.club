{"version":3,"sources":["Uwave.js"],"names":["Uwave","options","session","_this","readSession","sources","sessionToken","renderTarget","aboutPageComponent","jss","createJss","jssPreset","generateClassName","createGenerateClassName","ready","Promise","resolve","resolveReady","Object","assign","api","constants","components","actions","module","hot","getComponent","HotContainer","call","uw","accept","renderToDOM","_proto","prototype","use","plugin","source","sourcePlugin","opts","sourceFactory","default","type","TypeError","name","setAboutPageComponent","AboutPageComponent","getAboutPageComponent","build","_this2","store","configureStore","config","mediaSources","socketUrl","localePromise","createLocale","languageSelector","getState","dispatch","setSessionToken","window","setup","insertionPoint","document","querySelector","matchMedia","matches","then","preloadDesktop","socketConnect","all","initState","_ref","locale","Provider","JssProvider","AppContainer","uwave","target","element","React","StrictMode","render"],"mappings":"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","file":"Uwave.js","sourcesContent":["/* eslint-disable import/first */\nimport './polyfills';\nimport React from 'react';\nimport { render } from 'react-dom';\nimport { Provider } from 'react-redux';\nimport { AppContainer as HotContainer } from 'react-hot-loader';\nimport { create as createJss } from 'jss';\nimport { jssPreset } from '@material-ui/core/styles';\nimport JssProvider from 'react-jss/lib/JssProvider';\n/* eslint-enable */\nimport createLocale from './locale';\nimport AppContainer from './containers/App';\nimport { get as readSession } from './utils/Session';\nimport createGenerateClassName from './utils/createGenerateClassName';\nimport configureStore from './store/configureStore';\nimport { initState, socketConnect, setSessionToken } from './actions/LoginActionCreators';\nimport { languageSelector } from './selectors/settingSelectors';\nimport * as api from './api';\nimport preloadDesktop from './utils/preloadDesktop';\n// Register default chat commands.\nimport './utils/commands';\n\nexport default class Uwave {\n  options = {};\n  sources = {};\n  sessionToken = null;\n  renderTarget = null;\n  aboutPageComponent = null;\n\n  jss = createJss(jssPreset());\n  generateClassName = createGenerateClassName();\n\n  constructor(options = {}, session = readSession()) {\n    this.options = options;\n    this.sessionToken = session;\n    this.ready = new Promise((resolve) => {\n      this.resolveReady = resolve;\n    });\n\n    Object.assign(this, api.constants);\n    Object.assign(this, api.components);\n    Object.assign(this, api.actions);\n\n    if (module.hot) {\n      const { getComponent } = this;\n      this.getComponent = () => (\n        <HotContainer>{getComponent.call(this)}</HotContainer>\n      );\n      const uw = this;\n      module.hot.accept('./containers/App', () => {\n        if (uw.renderTarget) {\n          uw.renderToDOM(uw.renderTarget);\n        }\n      });\n    }\n  }\n\n  use(plugin) {\n    plugin(this);\n    return this;\n  }\n\n  source(sourcePlugin, opts = {}) {\n    const sourceFactory = sourcePlugin.default || sourcePlugin;\n\n    const type = typeof sourceFactory;\n    if (type !== 'function' && type !== 'object') {\n      throw new TypeError(`Source plugin should be a function, got ${type}`);\n    }\n\n    const source = type === 'function'\n      ? sourceFactory(this, opts)\n      : sourceFactory;\n\n    if (typeof source.name !== 'string') {\n      throw new TypeError('Source plugin did not provide a name');\n    }\n\n    this.sources[source.name] = source;\n\n    return source;\n  }\n\n  setAboutPageComponent(AboutPageComponent) {\n    this.aboutPageComponent = AboutPageComponent;\n  }\n  getAboutPageComponent() {\n    return this.aboutPageComponent;\n  }\n\n  build() {\n    this.store = configureStore(\n      { config: this.options },\n      { mediaSources: this.sources, socketUrl: this.options.socketUrl },\n    );\n\n    const localePromise = createLocale(languageSelector(this.store.getState()));\n\n    if (this.sessionToken) {\n      this.store.dispatch(setSessionToken(this.sessionToken));\n      this.sessionToken = null;\n    }\n\n    if (typeof window !== 'undefined') {\n      this.jss.setup({\n        insertionPoint: document.querySelector('#jss'),\n      });\n    }\n\n    if (typeof matchMedia !== 'undefined' && matchMedia('(min-width: 768px)').matches) {\n      this.ready.then(() => {\n        preloadDesktop();\n      });\n    }\n\n    this.store.dispatch(socketConnect());\n    return Promise.all([\n      localePromise,\n      this.store.dispatch(initState()),\n    ]).then(([locale]) => {\n      this.locale = locale;\n      this.resolveReady();\n    });\n  }\n\n  getComponent() {\n    return (\n      <Provider store={this.store}>\n        <JssProvider jss={this.jss} generateClassName={this.generateClassName}>\n          <AppContainer\n            mediaSources={this.sources}\n            locale={this.locale}\n            uwave={this}\n          />\n        </JssProvider>\n      </Provider>\n    );\n  }\n\n  renderToDOM(target) {\n    if (!this.store) {\n      this.build();\n    }\n\n    this.renderTarget = target;\n    const element = (\n      <React.StrictMode>\n        {this.getComponent()}\n      </React.StrictMode>\n    );\n    render(element, target);\n  }\n}\n"]}