{"version":3,"sources":["selectors/roomHistorySelectors.js"],"names":["createSelector","historyIDSelector","mediaSelector","startTimeSelector","djSelector","currentUserSelector","currentVotesSelector","byTimestamp","a","b","timestamp","baseSelector","state","roomHistory","roomHistorySelector","history","slice","sort","addOwnVoteProps","entry","stats","isDownvote","id","downvotes","indexOf","isFavorite","favorites","isUpvote","upvotes","currentPlaySelector","user","historyID","media","dj","_id","roomHistoryWithVotesSelector","current","map","unshift"],"mappings":";AAAA,SAASA,cAAT,QAA+B,UAA/B;AACA,SAASC,iBAAT,EAA4BC,aAA5B,EAA2CC,iBAA3C,EAA8DC,UAA9D,QAAgF,kBAAhF;AACA,SAASC,mBAAT,QAAoC,iBAApC;AACA,SAASC,oBAAT,QAAqC,iBAArC;;AAEA,IAAMC,cAAc,SAAdA,WAAc,CAACC,CAAD,EAAIC,CAAJ;AAAA,SAAWD,EAAEE,SAAF,GAAcD,EAAEC,SAAhB,GAA4B,CAA5B,GAAgC,CAAC,CAA5C;AAAA,CAApB;;AAEA,IAAMC,eAAe,SAAfA,YAAe;AAAA,SAASC,MAAMC,WAAf;AAAA,CAArB;;AAEA,OAAO,IAAMC,sBAAsBd,eACjCW,YADiC,EAEjC;AAAA,SAAWI,QAAQC,KAAR,GAAgBC,IAAhB,CAAqBV,WAArB,CAAX;AAAA,CAFiC,CAA5B;;AAKP,IAAMW,kBAAkB,SAAlBA,eAAkB;AAAA,SAAM;AAAA,wBACzBC,KADyB;AAE5BC,0BACKD,MAAMC,KADX;AAEE;AACAC,oBAAY,CAAC,CAACC,EAAF,IAAQH,MAAMC,KAAN,CAAYG,SAAZ,CAAsBC,OAAtB,CAA8BF,EAA9B,IAAoC,CAAC,CAH3D;AAIEG,oBAAY,CAAC,CAACH,EAAF,IAAQH,MAAMC,KAAN,CAAYM,SAAZ,CAAsBF,OAAtB,CAA8BF,EAA9B,IAAoC,CAAC,CAJ3D;AAKEK,kBAAU,CAAC,CAACL,EAAF,IAAQH,MAAMC,KAAN,CAAYQ,OAAZ,CAAoBJ,OAApB,CAA4BF,EAA5B,IAAkC,CAAC;AALvD;AAF4B;AAAA,GAAN;AAAA,CAAxB;;AAWA,OAAO,IAAMO,sBAAsB7B,eACjCK,mBADiC,EAEjCJ,iBAFiC,EAGjCC,aAHiC,EAIjCC,iBAJiC,EAKjCC,UALiC,EAMjCE,oBANiC,EAOjC,UAACwB,IAAD,EAAOC,SAAP,EAAkBC,KAAlB,EAAyBtB,SAAzB,EAAoCuB,EAApC,EAAwCb,KAAxC,EAAkD;AAChD,MAAI,CAACW,SAAL,EAAgB;AACd,WAAO,IAAP;AACD;AACD,MAAMZ,QAAQ;AACZe,SAAKH,SADO;AAEZD,UAAMG,EAFM;AAGZD,gBAHY;AAIZtB,wBAJY;AAKZU;AALY,GAAd;AAOA,SAAOF,gBAAgBY,OAAOA,KAAKI,GAAZ,GAAkB,IAAlC,EAAwCf,KAAxC,CAAP;AACD,CAnBgC,CAA5B;;AAsBP,OAAO,IAAMgB,+BAA+BnC,eAC1Cc,mBAD0C,EAE1CT,mBAF0C,EAG1CwB,mBAH0C,EAI1C,UAACd,OAAD,EAAUe,IAAV,EAAgBM,OAAhB,EAA4B;AAC1B,MAAMvB,cAAcE,QAAQsB,GAAR,CAAYnB,gBAAgBY,OAAOA,KAAKI,GAAZ,GAAkB,IAAlC,CAAZ,CAApB;AACA,MAAIE,OAAJ,EAAa;AACXvB,gBAAYyB,OAAZ,CAAoBF,OAApB;AACD;AACD,SAAOvB,WAAP;AACD,CAVyC,CAArC","file":"roomHistorySelectors.js","sourcesContent":["import { createSelector } from 'reselect';\nimport { historyIDSelector, mediaSelector, startTimeSelector, djSelector } from './boothSelectors';\nimport { currentUserSelector } from './userSelectors';\nimport { currentVotesSelector } from './voteSelectors';\n\nconst byTimestamp = (a, b) => (a.timestamp < b.timestamp ? 1 : -1);\n\nconst baseSelector = state => state.roomHistory;\n\nexport const roomHistorySelector = createSelector(\n  baseSelector,\n  history => history.slice().sort(byTimestamp),\n);\n\nconst addOwnVoteProps = id => entry => ({\n  ...entry,\n  stats: {\n    ...entry.stats,\n    // No ID is provided for guest users.\n    isDownvote: !!id && entry.stats.downvotes.indexOf(id) > -1,\n    isFavorite: !!id && entry.stats.favorites.indexOf(id) > -1,\n    isUpvote: !!id && entry.stats.upvotes.indexOf(id) > -1,\n  },\n});\n\nexport const currentPlaySelector = createSelector(\n  currentUserSelector,\n  historyIDSelector,\n  mediaSelector,\n  startTimeSelector,\n  djSelector,\n  currentVotesSelector,\n  (user, historyID, media, timestamp, dj, stats) => {\n    if (!historyID) {\n      return null;\n    }\n    const entry = {\n      _id: historyID,\n      user: dj,\n      media,\n      timestamp,\n      stats,\n    };\n    return addOwnVoteProps(user ? user._id : null)(entry);\n  },\n);\n\nexport const roomHistoryWithVotesSelector = createSelector(\n  roomHistorySelector,\n  currentUserSelector,\n  currentPlaySelector,\n  (history, user, current) => {\n    const roomHistory = history.map(addOwnVoteProps(user ? user._id : null));\n    if (current) {\n      roomHistory.unshift(current);\n    }\n    return roomHistory;\n  },\n);\n"]}