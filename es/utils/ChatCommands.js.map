{"version":3,"sources":["utils/ChatCommands.js"],"names":["find","createDebug","debug","commands","getCommands","register","name","description","action","guard","canExecute","state","execute","args","allowed","findUser","users","username","lname","toLowerCase","o"],"mappings":"AAAA,OAAOA,IAAP,MAAiB,YAAjB;AACA,OAAOC,WAAP,MAAwB,OAAxB;;AAEA,IAAMC,QAAQD,YAAY,qBAAZ,CAAd;;AAEA,IAAME,WAAW,EAAjB;;AAEA,OAAO,SAASC,WAAT,GAAuB;AAC5B,SAAOD,QAAP;AACD;;AAED,OAAO,SAASE,QAAT,CAAkBC,IAAlB,EAAwBC,WAAxB,QAAwD;AAAA,MAAjBC,MAAiB,QAAjBA,MAAiB;AAAA,MAATC,KAAS,QAATA,KAAS;;AAC7DN,WAASG,IAAT,IAAiB,EAAEC,wBAAF,EAAeC,cAAf,EAAuBC,YAAvB,EAAjB;AACD;;AAED,OAAO,SAASC,UAAT,CAAoBC,KAApB,EAA2C;AAAA,kFAAJ,EAAI;AAAA,MAAdF,KAAc,SAAdA,KAAc;;AAChD,SAAOA,QAAQA,MAAME,KAAN,CAAR,GAAuB,IAA9B;AACD;;AAED,OAAO,SAASC,OAAT,CAAiBD,KAAjB,EAAwBL,IAAxB,EAAyC;AAAA,MAAXO,IAAW,uEAAJ,EAAI;;AAC9CX,QAAM,SAAN,EAAiBI,IAAjB,EAAuBO,IAAvB;AACA,MAAIV,SAASG,IAAT,CAAJ,EAAoB;AAClB,QAAMQ,UAAUJ,WAAWC,KAAX,EAAkBR,SAASG,IAAT,CAAlB,CAAhB;AACAJ,UAAM,YAAN,EAAoBY,OAApB;AACA,QAAIA,OAAJ,EAAa;AAAA;;AACX,aAAO,2BAASR,IAAT,GAAeE,MAAf,uBAAyBK,IAAzB,CAAP;AACD;AACF;AACD,SAAO,IAAP;AACD;;AAED;AACA,OAAO,SAASE,QAAT,CAAkBC,KAAlB,EAAyBC,QAAzB,EAAmC;AACxC,MAAMC,QAAQD,SAASE,WAAT,EAAd;AACA,SAAOnB,KAAKgB,KAAL,EAAY;AAAA,WAAKI,EAAEH,QAAF,CAAWE,WAAX,OAA6BD,KAAlC;AAAA,GAAZ,CAAP;AACD","file":"ChatCommands.js","sourcesContent":["import find from 'array-find';\nimport createDebug from 'debug';\n\nconst debug = createDebug('uwave:chat-commands');\n\nconst commands = {};\n\nexport function getCommands() {\n  return commands;\n}\n\nexport function register(name, description, { action, guard }) {\n  commands[name] = { description, action, guard };\n}\n\nexport function canExecute(state, { guard } = {}) {\n  return guard ? guard(state) : true;\n}\n\nexport function execute(state, name, args = []) {\n  debug('execute', name, args);\n  if (commands[name]) {\n    const allowed = canExecute(state, commands[name]);\n    debug('canExecute', allowed);\n    if (allowed) {\n      return commands[name].action(...args);\n    }\n  }\n  return null;\n}\n\n// Helper to consistently find online users in command handlers.\nexport function findUser(users, username) {\n  const lname = username.toLowerCase();\n  return find(users, o => o.username.toLowerCase() === lname);\n}\n"]}