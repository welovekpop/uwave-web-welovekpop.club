{"version":3,"sources":["components/MediaList/BaseMediaList.js"],"names":["cx","React","PropTypes","BaseList","LazyList","itemSelection","LoadingRow","didMediaChange","prev","next","some","item","i","_id","BaseMediaList","state","selection","props","media","renderList","items","ref","ListComponent","listComponent","renderRow","index","makeActions","rowProps","RowComponent","rowComponent","onOpenPreviewMediaDialog","selected","isSelectedIndex","get","selectItem","e","componentWillReceiveProps","nextProps","selectedIndices","getIndices","mediaChanged","setState","preventDefault","shiftKey","selectRange","ctrlKey","selectToggle","select","render","className","size","onRequestPage","list","length","Component","defaultProps","propTypes","string","array","number","func","oneOfType","isRequired","object"],"mappings":";;;AAAA,OAAOA,EAAP,MAAe,YAAf;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,QAAP,MAAqB,YAArB;AACA,OAAOC,QAAP,MAAqB,sBAArB;AACA,OAAOC,aAAP,MAA0B,0BAA1B;AACA,OAAOC,UAAP,MAAuB,cAAvB;AAEA;;;;;;;;AAOA,SAASC,cAAT,CAAwBC,IAAxB,EAA8BC,IAA9B,EAAoC;AAClC,SAAOD,KAAKE,IAAL,CAAU,UAACC,IAAD,EAAOC,CAAP;AAAA,WAAaD,QAAQF,KAAKG,CAAL,CAAR,IAAmBD,KAAKE,GAAL,KAAaJ,KAAKG,CAAL,EAAQC,GAArD;AAAA,GAAV,CAAP;AACD;;IAEoBC,a;;;;;;;;;;;;;UAuBnBC,K,GAAQ;AACN;AACAC,iBAAWX,cAAc,MAAKY,KAAL,CAAWC,KAAzB;AAFL,K;;UAoCRC,U,GAAa,UAACC,KAAD,EAAQC,GAAR,EAAgB;AAAA,UACJC,aADI,GACc,MAAKL,KADnB,CACnBM,aADmB;AAG3B,aACE,oBAAC,aAAD;AAAe,aAAKF;AAApB,SACGD,KADH,CADF;AAKD,K;;UAEDI,S,GAAY,UAACC,KAAD,EAAW;AAAA,wBAOjB,MAAKR,KAPY;AAAA,UAEnBS,YAFmB,eAEnBA,WAFmB;AAAA,6CAGnBC,QAHmB;AAAA,UAGTV,KAHS,qCAGD,EAHC;AAAA,UAInBC,KAJmB,eAInBA,KAJmB;AAAA,UAKLU,YALK,eAKnBC,YALmB;AAAA,UAMnBC,wBANmB,eAMnBA,wBANmB;AAAA,UAQbd,SARa,GAQC,MAAKD,KARN,CAQbC,SARa;AAUrB,UAAMe,WAAWf,UAAUgB,eAAV,CAA0BP,KAA1B,CAAjB;;AACA,UAAI,CAACP,MAAMO,KAAN,CAAL,EAAmB;AACjB,eACE,KAAC,UAAD;AAEE,qBAAU,eAFZ;AAGE,oBAAUM;AAHZ,WACON,KADP,CADF;AAOD;;AAED,aACE,oBAAC,YAAD;AACE,aAAKP,MAAMO,KAAN,IAAeP,MAAMO,KAAN,EAAaZ,GAA5B,GAAkCY;AADzC,SAEMR,KAFN;AAGE,mBAAU,eAHZ;AAIE,eAAOC,MAAMO,KAAN,CAJT;AAKE,kBAAUM,QALZ;AAME,mBAAWf,UAAUiB,GAAV,EANb;AAOE,iBAAS;AAAA,iBAAK,MAAKC,UAAL,CAAgBT,KAAhB,EAAuBU,CAAvB,CAAL;AAAA,SAPX;AAQE,kCAA0BL,wBAR5B;AASE,qBAAa;AAAA,iBAAMJ,aAAYR,MAAMO,KAAN,CAAZ,EAA0BT,SAA1B,EAAqCS,KAArC,CAAN;AAAA;AATf,SADF;AAaD,K;;;;;;;SA3EDW,yB,sCAA0BC,S,EAAW;AAAA,QAC3BnB,KAD2B,GACjB,KAAKD,KADY,CAC3BC,KAD2B;AAAA,QAE3BF,SAF2B,GAEb,KAAKD,KAFQ,CAE3BC,SAF2B;;AAInC,QAAIqB,UAAUnB,KAAV,KAAoBA,KAAxB,EAA+B;AAC7B,UAAMoB,kBAAkBtB,UAAUuB,UAAV,EAAxB;AACA,UAAMC,eAAejC,eAAeW,KAAf,EAAsBmB,UAAUnB,KAAhC,CAArB;AACA,WAAKuB,QAAL,CAAc;AACZzB,mBAAWwB,eACPnC,cAAcgC,UAAUnB,KAAxB,CADO,GAEPb,cAAcgC,UAAUnB,KAAxB,EAA+BoB,eAA/B;AAHQ,OAAd;AAKD;AACF,G;;SAEDJ,U,uBAAWT,K,EAAOU,C,EAAG;AACnBA,MAAEO,cAAF;AADmB,QAGb1B,SAHa,GAGC,KAAKD,KAHN,CAGbC,SAHa;;AAKnB,QAAImB,EAAEQ,QAAN,EAAgB;AACd3B,kBAAYA,UAAU4B,WAAV,CAAsBnB,KAAtB,CAAZ;AACD,KAFD,MAEO,IAAIU,EAAEU,OAAN,EAAe;AACpB7B,kBAAYA,UAAU8B,YAAV,CAAuBrB,KAAvB,CAAZ;AACD,KAFM,MAEA;AACLT,kBAAYA,UAAU+B,MAAV,CAAiBtB,KAAjB,CAAZ;AACD;;AAED,SAAKgB,QAAL,CAAc;AAAEzB;AAAF,KAAd;AACD,G;;SAgDDgC,M,qBAAS;AAAA,uBAGH,KAAK/B,KAHF;AAAA,QAELgC,SAFK,gBAELA,SAFK;AAAA,QAEM/B,KAFN,gBAEMA,KAFN;AAAA,QAEagC,IAFb,gBAEaA,IAFb;AAAA,QAEmBC,aAFnB,gBAEmBA,aAFnB;AAAA,QAICnC,SAJD,GAIe,KAAKD,KAJpB,CAICC,SAJD;;AAMP,QAAIoC,OACF,KAAC,QAAD;AACE,qBAAe,KAAKjC,UADtB;AAEE,oBAAc,KAAKK,SAFrB;AAGE,cAAQ0B,QAAQhC,MAAMmC,MAHxB;AAIE,YAAK,SAJP;AAKE,gCAA0BnC,KAL5B;AAME,oCAA8BF;AANhC,MADF;;AAWA,QAAImC,aAAJ,EAAmB;AACjBC,aACE,KAAC,QAAD;AACE,eAAOlC,KADT;AAEE,gBAAQgC,QAAQhC,MAAMmC,MAFxB;AAGE,kBAAU,EAHZ;AAIE,uBAAeF;AAJjB,iBAMGC,IANH,CADF;AAUD;;AAED,WACE;AAAK,iBAAWpD,GAAG,WAAH,EAAgBiD,SAAhB;AAAhB,eACGG,IADH,CADF;AAKD,G;;;EA5IwCnD,MAAMqD,S;;;;AAoB1B,gB;;AApBFxC,a,CAiBZyC,Y,GAAe;AACpB;AACAL,QAAM,IAFc;AAGpBxB,eAAa;AAAA;AAAA;AAHO,C;SAjBHZ,a;AAAAA,a,CACZ0C,S,2CAAY;AACjBP,aAAW/C,UAAUuD,MADJ;AAEjBvC,SAAOhB,UAAUwD,KAFA;AAGjBR,QAAMhD,UAAUyD,MAHC;AAIjBR,iBAAejD,UAAU0D,IAJR;AAKjBrC,iBAAerB,UAAU2D,SAAV,CAAoB,CACjC3D,UAAUuD,MADuB,EAEjCvD,UAAU0D,IAFuB,CAApB,EAGZE,UARc;AASjBjC,gBAAc3B,UAAU0D,IAAV,CAAeE,UATZ;AAUjBnC,YAAUzB,UAAU6D,MAVH;AAYjBjC,4BAA0B5B,UAAU0D,IAZnB;AAajBlC,eAAaxB,UAAU0D;AAbN,C","sourcesContent":["import cx from 'classnames';\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport BaseList from 'react-list';\nimport LazyList from 'react-list-lazy-load';\nimport itemSelection from 'item-selection/immutable';\nimport LoadingRow from './LoadingRow';\n\n/**\n * Check if two media lists are different, taking into account\n * pagination. If the new media list contains items where the previous\n * list doesn't, but every other item is identical, we assume\n * the new list has just loaded a page that wasn't loaded in the\n * previous one, and decide that the list is not really different.\n */\nfunction didMediaChange(prev, next) {\n  return prev.some((item, i) => item && next[i] && item._id !== next[i]._id);\n}\n\nexport default class BaseMediaList extends React.Component {\n  static propTypes = {\n    className: PropTypes.string,\n    media: PropTypes.array,\n    size: PropTypes.number,\n    onRequestPage: PropTypes.func,\n    listComponent: PropTypes.oneOfType([\n      PropTypes.string,\n      PropTypes.func,\n    ]).isRequired,\n    rowComponent: PropTypes.func.isRequired,\n    rowProps: PropTypes.object,\n\n    onOpenPreviewMediaDialog: PropTypes.func,\n    makeActions: PropTypes.func,\n  };\n\n  static defaultProps = {\n    // The `size` property is only necessary for lazy loading.\n    size: null,\n    makeActions: () => <span />,\n  };\n\n  state = {\n    // eslint-disable-next-line react/destructuring-assignment\n    selection: itemSelection(this.props.media),\n  };\n\n  componentWillReceiveProps(nextProps) {\n    const { media } = this.props;\n    const { selection } = this.state;\n\n    if (nextProps.media !== media) {\n      const selectedIndices = selection.getIndices();\n      const mediaChanged = didMediaChange(media, nextProps.media);\n      this.setState({\n        selection: mediaChanged\n          ? itemSelection(nextProps.media)\n          : itemSelection(nextProps.media, selectedIndices),\n      });\n    }\n  }\n\n  selectItem(index, e) {\n    e.preventDefault();\n\n    let { selection } = this.state;\n\n    if (e.shiftKey) {\n      selection = selection.selectRange(index);\n    } else if (e.ctrlKey) {\n      selection = selection.selectToggle(index);\n    } else {\n      selection = selection.select(index);\n    }\n\n    this.setState({ selection });\n  }\n\n  renderList = (items, ref) => {\n    const { listComponent: ListComponent } = this.props;\n\n    return (\n      <ListComponent ref={ref}>\n        {items}\n      </ListComponent>\n    );\n  };\n\n  renderRow = (index) => {\n    const {\n      makeActions,\n      rowProps: props = {},\n      media,\n      rowComponent: RowComponent,\n      onOpenPreviewMediaDialog,\n    } = this.props;\n    const { selection } = this.state;\n\n    const selected = selection.isSelectedIndex(index);\n    if (!media[index]) {\n      return (\n        <LoadingRow\n          key={index}\n          className=\"MediaList-row\"\n          selected={selected}\n        />\n      );\n    }\n\n    return (\n      <RowComponent\n        key={media[index] ? media[index]._id : index}\n        {...props}\n        className=\"MediaList-row\"\n        media={media[index]}\n        selected={selected}\n        selection={selection.get()}\n        onClick={e => this.selectItem(index, e)}\n        onOpenPreviewMediaDialog={onOpenPreviewMediaDialog}\n        makeActions={() => makeActions(media[index], selection, index)}\n      />\n    );\n  };\n\n  render() {\n    const {\n      className, media, size, onRequestPage,\n    } = this.props;\n    const { selection } = this.state;\n\n    let list = (\n      <BaseList\n        itemsRenderer={this.renderList}\n        itemRenderer={this.renderRow}\n        length={size || media.length}\n        type=\"uniform\"\n        forceUpdateOnMediaChange={media}\n        forceUpdateOnSelectionChange={selection}\n      />\n    );\n\n    if (onRequestPage) {\n      list = (\n        <LazyList\n          items={media}\n          length={size || media.length}\n          pageSize={50}\n          onRequestPage={onRequestPage}\n        >\n          {list}\n        </LazyList>\n      );\n    }\n\n    return (\n      <div className={cx('MediaList', className)}>\n        {list}\n      </div>\n    );\n  }\n}\n"],"file":"BaseMediaList.js"}