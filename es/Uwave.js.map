{"version":3,"sources":["Uwave.js"],"names":["React","render","Provider","AppContainer","HotContainer","create","createJss","jssPreset","JssProvider","createLocale","get","readSession","createGenerateClassName","configureStore","initState","socketConnect","setSessionToken","languageSelector","api","preloadDesktop","Uwave","options","session","sources","sessionToken","renderTarget","aboutPageComponent","jss","generateClassName","ready","Promise","resolve","resolveReady","Object","assign","constants","components","actions","module","hot","getComponent","call","uw","accept","renderToDOM","use","plugin","source","sourcePlugin","opts","sourceFactory","default","type","TypeError","name","setAboutPageComponent","AboutPageComponent","getAboutPageComponent","build","store","config","mediaSources","socketUrl","localePromise","getState","dispatch","window","setup","insertionPoint","document","querySelector","matchMedia","matches","then","all","locale","target","element"],"mappings":"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","sourcesContent":["/* eslint-disable import/first */\nimport './polyfills';\nimport React from 'react';\nimport { render } from 'react-dom';\nimport { Provider } from 'react-redux';\nimport { AppContainer as HotContainer } from 'react-hot-loader';\nimport { create as createJss } from 'jss';\nimport { jssPreset } from '@material-ui/core/styles';\nimport JssProvider from 'react-jss/lib/JssProvider';\n/* eslint-enable */\nimport createLocale from './locale';\nimport AppContainer from './containers/App';\nimport { get as readSession } from './utils/Session';\nimport createGenerateClassName from './utils/createGenerateClassName';\nimport configureStore from './store/configureStore';\nimport { initState, socketConnect, setSessionToken } from './actions/LoginActionCreators';\nimport { languageSelector } from './selectors/settingSelectors';\nimport * as api from './api';\nimport preloadDesktop from './utils/preloadDesktop';\n// Register default chat commands.\nimport './utils/commands';\n\nexport default class Uwave {\n  options = {};\n  sources = {};\n  sessionToken = null;\n  renderTarget = null;\n  aboutPageComponent = null;\n\n  jss = createJss(jssPreset());\n  generateClassName = createGenerateClassName();\n\n  constructor(options = {}, session = readSession()) {\n    this.options = options;\n    this.sessionToken = session;\n    this.ready = new Promise((resolve) => {\n      this.resolveReady = resolve;\n    });\n\n    Object.assign(this, api.constants);\n    Object.assign(this, api.components);\n    Object.assign(this, api.actions);\n\n    if (module.hot) {\n      const { getComponent } = this;\n      this.getComponent = () => (\n        <HotContainer>{getComponent.call(this)}</HotContainer>\n      );\n      const uw = this;\n      module.hot.accept('./containers/App', () => {\n        if (uw.renderTarget) {\n          uw.renderToDOM(uw.renderTarget);\n        }\n      });\n    }\n  }\n\n  use(plugin) {\n    plugin(this);\n    return this;\n  }\n\n  source(sourcePlugin, opts = {}) {\n    const sourceFactory = sourcePlugin.default || sourcePlugin;\n\n    const type = typeof sourceFactory;\n    if (type !== 'function' && type !== 'object') {\n      throw new TypeError(`Source plugin should be a function, got ${type}`);\n    }\n\n    const source = type === 'function'\n      ? sourceFactory(this, opts)\n      : sourceFactory;\n\n    if (typeof source.name !== 'string') {\n      throw new TypeError('Source plugin did not provide a name');\n    }\n\n    this.sources[source.name] = source;\n\n    return source;\n  }\n\n  setAboutPageComponent(AboutPageComponent) {\n    this.aboutPageComponent = AboutPageComponent;\n  }\n  getAboutPageComponent() {\n    return this.aboutPageComponent;\n  }\n\n  build() {\n    this.store = configureStore(\n      { config: this.options },\n      { mediaSources: this.sources, socketUrl: this.options.socketUrl },\n    );\n\n    const localePromise = createLocale(languageSelector(this.store.getState()));\n\n    if (this.sessionToken) {\n      this.store.dispatch(setSessionToken(this.sessionToken));\n      this.sessionToken = null;\n    }\n\n    if (typeof window !== 'undefined') {\n      this.jss.setup({\n        insertionPoint: document.querySelector('#jss'),\n      });\n    }\n\n    if (typeof matchMedia !== 'undefined' && matchMedia('(min-width: 768px)').matches) {\n      this.ready.then(() => {\n        preloadDesktop();\n      });\n    }\n\n    this.store.dispatch(socketConnect());\n    return Promise.all([\n      localePromise,\n      this.store.dispatch(initState()),\n    ]).then(([locale]) => {\n      this.locale = locale;\n      this.resolveReady();\n    });\n  }\n\n  getComponent() {\n    return (\n      <Provider store={this.store}>\n        <JssProvider jss={this.jss} generateClassName={this.generateClassName}>\n          <AppContainer\n            mediaSources={this.sources}\n            locale={this.locale}\n            uwave={this}\n          />\n        </JssProvider>\n      </Provider>\n    );\n  }\n\n  renderToDOM(target) {\n    if (!this.store) {\n      this.build();\n    }\n\n    this.renderTarget = target;\n    const element = (\n      <React.StrictMode>\n        {this.getComponent()}\n      </React.StrictMode>\n    );\n    render(element, target);\n  }\n}\n"],"file":"Uwave.js"}