{"version":3,"sources":["Uwave.js"],"names":["React","render","Provider","AppContainer","HotContainer","createLocale","get","readSession","configureStore","initState","socketConnect","setJWT","languageSelector","api","Uwave","options","session","sources","jwt","renderTarget","aboutPageComponent","ready","Promise","resolve","resolveReady","Object","assign","constants","components","actions","module","hot","_getComponent","getComponent","uw","accept","renderToDOM","use","plugin","source","sourceType","sourcePlugin","opts","sourceFactory","default","type","TypeError","setAboutPageComponent","AboutPageComponent","getAboutPageComponent","build","store","config","mediaSources","socketUrl","localePromise","getState","dispatch","all","then","locale","target"],"mappings":"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","file":"Uwave.js","sourcesContent":["// Polyfills for browsers that might not yet support Promises or the Fetch API\n// (newer & better XMLHttpRequest).\nimport 'lie/polyfill';\nimport 'whatwg-fetch';\n\nimport React from 'react';\nimport { render } from 'react-dom';\nimport { Provider } from 'react-redux';\nimport { AppContainer as HotContainer } from 'react-hot-loader';\nimport createLocale from './locale';\nimport AppContainer from './containers/App';\nimport { get as readSession } from './utils/Session';\nimport configureStore from './store/configureStore';\nimport { initState, socketConnect, setJWT } from './actions/LoginActionCreators';\nimport { languageSelector } from './selectors/settingSelectors';\nimport * as api from './api';\n\n// Register default chat commands.\nimport './utils/commands';\n\nexport default class Uwave {\n  options = {};\n  sources = {};\n  jwt = null;\n  renderTarget = null;\n  aboutPageComponent = null;\n\n  constructor(options = {}, session = readSession()) {\n    this.options = options;\n    this.jwt = session;\n    this.ready = new Promise((resolve) => {\n      this.resolveReady = resolve;\n    });\n\n    Object.assign(this, api.constants);\n    Object.assign(this, api.components);\n    Object.assign(this, api.actions);\n\n    if (module.hot) {\n      this._getComponent = this.getComponent;\n      this.getComponent = () => (\n        <HotContainer>{this._getComponent()}</HotContainer>\n      );\n      const uw = this;\n      module.hot.accept('./containers/App', () => {\n        if (uw.renderTarget) {\n          uw.renderToDOM(uw.renderTarget);\n        }\n      });\n    }\n  }\n\n  use(plugin) {\n    plugin(this);\n    return this;\n  }\n\n  source(sourceType, sourcePlugin, opts = {}) {\n    const sourceFactory = sourcePlugin.default || sourcePlugin;\n\n    const type = typeof sourceFactory;\n    if (type !== 'function' && type !== 'object') {\n      throw new TypeError(`Source plugin should be a function, got ${type}`);\n    }\n\n    const source = type === 'function'\n      ? sourceFactory(this, opts)\n      : sourceFactory;\n\n    this.sources[sourceType] = source;\n\n    return source;\n  }\n\n  setAboutPageComponent(AboutPageComponent) {\n    this.aboutPageComponent = AboutPageComponent;\n  }\n  getAboutPageComponent() {\n    return this.aboutPageComponent;\n  }\n\n  build() {\n    this.store = configureStore(\n      { config: this.options },\n      { mediaSources: this.sources, socketUrl: this.options.socketUrl }\n    );\n\n    const localePromise = createLocale(\n      languageSelector(this.store.getState())\n    );\n\n    if (this.jwt) {\n      this.store.dispatch(setJWT(this.jwt));\n      this.jwt = null;\n    }\n\n    this.store.dispatch(socketConnect());\n    return Promise.all([\n      localePromise,\n      this.store.dispatch(initState())\n    ]).then(([ locale ]) => {\n      this.locale = locale;\n      this.resolveReady();\n    });\n  }\n\n  getComponent() {\n    return (\n      <Provider store={this.store}>\n        <AppContainer\n          mediaSources={this.sources}\n          locale={this.locale}\n          uwave={this}\n        />\n      </Provider>\n    );\n  }\n\n  renderToDOM(target) {\n    if (!this.store) {\n      this.build();\n    }\n\n    this.renderTarget = target;\n    render(this.getComponent(), target);\n  }\n}\n"]}