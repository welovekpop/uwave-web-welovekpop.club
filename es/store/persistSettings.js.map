{"version":3,"sources":["store/persistSettings.js"],"names":["isEqual","loadSettings","SETTINGS_KEY","attempt","fn","undefined","e","persistSettings","reducer","initialState","settings","JSON","parse","localStorage","getItem","store","next","dispatch","prevSettings","subscribe","newSettings","getState","setItem","stringify"],"mappings":"AAAA,OAAOA,OAAP,MAAoB,kBAApB;AACA,SAASC,YAAT,QAA6B,mCAA7B;AAEA,IAAMC,eAAe,eAArB;;AAEA,IAAMC,UAAU,SAAVA,OAAU,CAACC,EAAD,EAAQ;AACtB,MAAI;AACF,WAAOA,QAAQC,SAAf;AACD,GAFD,CAEE,OAAOC,CAAP,EAAU;AACV,WAAOD,SAAP;AACD;AACF,CAND,C,CAQA;AACA;AACA;AACA;;;AACA,IAAME,kBAAkB,SAAlBA,eAAkB;AAAA,SAAQ,UAACC,OAAD,EAAUC,YAAV,EAA2B;AACzD,QAAMC,WAAWP,QAAQ;AAAA,aACvBQ,KAAKC,KAAL,CAAWC,aAAaC,OAAb,CAAqBZ,YAArB,CAAX,CADuB;AAAA,KAAR,CAAjB;AAGA,QAAMa,QAAQC,KAAKR,OAAL,EAAcC,YAAd,CAAd;AAEAM,UAAME,QAAN,CAAehB,aAAaS,QAAb,CAAf;AAEA,QAAIQ,eAAeR,QAAnB;AACAK,UAAMI,SAAN,CAAgB,YAAM;AACpB,UAAMC,cAAcL,MAAMM,QAAN,GAAiBX,QAArC;;AACA,UAAI,CAACV,QAAQkB,YAAR,EAAsBE,WAAtB,CAAL,EAAyC;AACvCjB,gBAAQ;AAAA,iBACNU,aAAaS,OAAb,CAAqBpB,YAArB,EAAmCS,KAAKY,SAAL,CAAeH,WAAf,CAAnC,CADM;AAAA,SAAR;AAED;;AACDF,qBAAeE,WAAf;AACD,KAPD;AAQA,WAAOL,KAAP;AACD,GAlBuB;AAAA,CAAxB;;AAoBA,eAAeR,eAAf","sourcesContent":["import isEqual from 'is-equal-shallow';\nimport { loadSettings } from '../actions/SettingsActionCreators';\n\nconst SETTINGS_KEY = 'uwaveSettings';\n\nconst attempt = (fn) => {\n  try {\n    return fn() || undefined;\n  } catch (e) {\n    return undefined;\n  }\n};\n\n// [Store enhancer][1] that saves and loads app settings to and from\n// localStorage.\n//\n// [1]: http://redux.js.org/docs/Glossary.html#store-enhancer\nconst persistSettings = next => (reducer, initialState) => {\n  const settings = attempt(() =>\n    JSON.parse(localStorage.getItem(SETTINGS_KEY)));\n\n  const store = next(reducer, initialState);\n\n  store.dispatch(loadSettings(settings));\n\n  let prevSettings = settings;\n  store.subscribe(() => {\n    const newSettings = store.getState().settings;\n    if (!isEqual(prevSettings, newSettings)) {\n      attempt(() =>\n        localStorage.setItem(SETTINGS_KEY, JSON.stringify(newSettings)));\n    }\n    prevSettings = newSettings;\n  });\n  return store;\n};\n\nexport default persistSettings;\n"],"file":"persistSettings.js"}